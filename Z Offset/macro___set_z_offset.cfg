[gcode_macro APPLY_USER_Z_OFFSET]
description: Aplica el Z-offset guardado en variables.cfg sin reiniciar
gcode:
    # 1. Acceder a las variables guardadas
    {% set svv = printer.save_variables.variables %}
    
    # 2. Leer el valor 'user_z_offset'. Si no existe, usa 0.0
    {% set my_offset = svv.user_z_offset|default(0.0)|float %}
    
    # 3. Informar en consola
    {action_respond_info("Aplicando Z-Offset de usuario: " ~ my_offset)}
    
    # 4. Aplicar el offset (se suma al del prtouch)
    SET_GCODE_OFFSET Z={my_offset} MOVE=1

[gcode_macro SET_USER_Z]
description: Guarda el Z-Offset. ¡Pulsa la flecha/engranaje para poner el valor!
gcode:
    {% if 'Z' in params %}
        {% set new_z = params.Z|float %}
        SAVE_VARIABLE VARIABLE=user_z_offset VALUE={new_z}
        {action_respond_info("✅ ÉXITO: Nuevo Z-Offset guardado: " ~ new_z)}
        {action_respond_info("Se aplicará en la próxima impresión.")}
    {% else %}
        # Esto saldrá si pulsas el botón sin poner el numero
        {action_respond_info("⚠️ ERROR: No has escrito el valor.")}
        {action_respond_info("PISTA: No pulses el botón directo. Pulsa la flechita de al lado e introduce Z=... ")}
    {% endif %}
    